<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cam WebViewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            background: #000;
        }

        .app {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .cam-layout {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(6, 1fr);
            gap: 0;
            background: #000;
        }

        .cam {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #000;
        }

        .cam video {
            width: 100%;
            height: 100%;
            border: 1px solid #333;
            object-fit: fill;
            display: block;
        }

        .cam-1 { grid-column: 1; grid-row: 1 / span 3; }
        .cam-2 { grid-column: 1; grid-row: 4 / span 3; }
        .cam-3 { grid-column: 3; grid-row: 1 / span 3; }
        .cam-4 { grid-column: 3; grid-row: 4 / span 3; }

        .cam-5 { grid-column: 2; grid-row: 1 / span 2; }
        .cam-6 { grid-column: 2; grid-row: 3 / span 2; }
        .cam-7 { grid-column: 2; grid-row: 5 / span 2; }

        .timer-panel {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #555;
            border-radius: 4px;
            padding: 6px 10px;
            z-index: 1000;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            color: #0f0;
        }

        .timer-display {
            display: inline;
            font-weight: bold;
            margin-right: 8px;
        }

        .timer-controls {
            display: inline-flex;
            gap: 4px;
            align-items: center;
        }

        .timer-controls input {
            width: 40px;
            padding: 2px 4px;
            border: 1px solid #555;
            background: #1a1a1a;
            color: #0f0;
            border-radius: 2px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
        }

        .layout-select {
            width: 82px;
            padding: 2px 4px;
            border: 1px solid #555;
            background: #1a1a1a;
            color: #0f0;
            border-radius: 2px;
            font-size: 11px;
            font-family: 'Courier New', monospace;
        }

        .timer-controls button {
            padding: 2px 6px;
            background: #555;
            color: #fff;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
            transition: background 0.2s;
        }

        .timer-controls button:hover {
            background: #777;
        }

        #resetBtn {
            padding: 2px 6px;
            background: #0f0;
            color: #000;
            border: none;
            border-radius: 2px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: background 0.2s;
        }

        #resetBtn:hover {
            background: #0c0;
        }
    </style>
</head>
<body>
    <main class="app">
        <section class="cam-layout">
            <div class="cam cam-1">
                <video src="{{CAM1}}" autoplay muted playsinline></video>
            </div>
            <div class="cam cam-2">
                <video src="{{CAM3}}" autoplay muted playsinline></video>
            </div>
            <div class="cam cam-3">
                <video src="{{CAM6}}" autoplay muted playsinline></video>
            </div>
            <div class="cam cam-4">
                <video src="{{CAM7}}" autoplay muted playsinline></video>
            </div>

            <div class="cam cam-5">
                <video src="{{CAM2}}" autoplay muted playsinline></video>
            </div>
            <div class="cam cam-6">
                <video src="{{CAM4}}" autoplay muted playsinline></video>
            </div>
            <div class="cam cam-7">
                <video src="{{CAM5}}" autoplay muted playsinline></video>
            </div>
        </section>
    </main>

    <div class="timer-panel">
        <span class="timer-display" id="timerDisplay">{{RESET_MINUTES}}:00</span>
        <div class="timer-controls">
            <input type="number" id="minutesInput" min="1" max="120" value="{{RESET_MINUTES}}">
            <select id="layoutSelect" class="layout-select">
                <option value="1">Layout 1</option>
                <option value="2">Layout 2</option>
            </select>
            <button id="setBtn">✓</button>
            <button id="resetBtn">⟳</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>
    <script>
        window.addEventListener('load', function() {
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                video.play().catch(err => console.log('Autoplay blocked:', err));
            });
        });

        const defaultResetMinutes = parseInt('{{RESET_MINUTES}}', 10) || 15;
        let totalSeconds = defaultResetMinutes * 60;
        let remainingSeconds = totalSeconds;
        let timerInterval;

        const timerDisplay = document.getElementById('timerDisplay');
        const minutesInput = document.getElementById('minutesInput');
        const layoutSelect = document.getElementById('layoutSelect');
        const setBtn = document.getElementById('setBtn');
        const resetBtn = document.getElementById('resetBtn');
        const currentLayout = '{{CURRENT_LAYOUT}}';

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateDisplay() {
            timerDisplay.textContent = formatTime(remainingSeconds);
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);

            timerInterval = setInterval(() => {
                remainingSeconds--;
                updateDisplay();

                if (remainingSeconds <= 0) {
                    clearInterval(timerInterval);
                    refreshPage();
                }
            }, 1000);
        }

        function refreshPage() {
            location.reload();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            remainingSeconds = totalSeconds;
            updateDisplay();
            startTimer();
        }

        function setNewTime() {
            const minutes = parseInt(minutesInput.value, 10);

            if (isNaN(minutes) || minutes < 1 || minutes > 120) {
                alert('Por favor, insira um valor entre 1 e 120 minutos');
                return;
            }

            totalSeconds = minutes * 60;
            resetTimer();
        }

        setBtn.addEventListener('click', setNewTime);
        resetBtn.addEventListener('click', resetTimer);
        layoutSelect.value = currentLayout;
        layoutSelect.addEventListener('change', function() {
            const params = new URLSearchParams(window.location.search);
            params.set('layout', layoutSelect.value);
            window.location.search = params.toString();
        });

        updateDisplay();
        startTimer();
    </script>
</body>
</html>
